# -*- coding: utf-8 -*-

from metasploit.msfrpc import MsfRpcClient

msf_host = '192.168.1.1'
msf_pass = 'password'

client = MsfRpcClient(msf_pass, server=msf_host, ssl=False)

for x, y in client.sessions.list.iteritems():
    meterpreter = client.sessions.session(int(x))
    # do what you want
    # example:
    # meterpreter.runsingle('ifconfig')
    # enter the system shell
    # meterpreter.runsingle('shell')
	# after you enter the shell, you can execute system shell commands
    # shell.write('ipconfig /all')
    # shell.read()
    meterpreter.stop()